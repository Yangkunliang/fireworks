<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ å°å­¦ä¸€å¹´çº§å­¦ä¹ æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 24px;
            color: #ff6b6b;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subject-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .subject-btn {
            height: 60px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .subject-btn.math {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .subject-btn.chinese {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .subject-btn.english {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .subject-btn.active {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            height: 50px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .difficulty-btn.easy {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .difficulty-btn.medium {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .difficulty-btn.hard {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .difficulty-btn.active {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 3px solid #fff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .stat-card.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            font-size: 14px;
            color: #fff;
            font-weight: bold;
            margin-top: 5px;
        }

        .question-container {
            background: linear-gradient(135deg, #a8e6cf, #88d8c0);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
            border: 4px solid #fff;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .question {
            font-size: 32px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .input-container {
            margin-bottom: 20px;
        }

        .answer-input {
            width: 120px;
            height: 60px;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            border: 4px solid #74b9ff;
            border-radius: 15px;
            background: #fff;
            color: #2d3436;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .answer-input:focus {
            outline: none;
            border-color: #0984e3;
            box-shadow: 0 0 20px rgba(116, 185, 255, 0.5);
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        /* é€‰æ‹©é¢˜é€‰é¡¹ */
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            height: 60px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ddd6fe, #c4b5fd);
            color: #2d3436;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.15);
        }

        .option-btn:active {
            transform: translateY(0);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            transform: scale(1.05);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            animation: correctPulse 0.6s ease;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            animation: incorrectShake 0.6s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .button-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            height: 60px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-submit {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #00a085, #008f7a);
            transform: translateY(-2px);
        }

        .btn-next {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .btn-next:hover {
            background: linear-gradient(135deg, #0984e3, #0770c4);
            transform: translateY(-2px);
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-control {
            height: 50px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-control:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border: 3px solid #00a085;
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            border: 3px solid #d63384;
        }

        .ready-message {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #2d3436;
            border: 3px solid #e17055;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            z-index: 1000;
            animation: celebrate 0.8s ease-out;
            pointer-events: none;
        }

        @keyframes celebrate {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 1;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) rotate(360deg);
                opacity: 0;
            }
        }

        .streak-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ff9ff3, #f368e0);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        /* éšè—æ•°å­¦è¾“å…¥æ¡† */
        .math-mode .options-container {
            display: none;
        }

        .choice-mode .input-container {
            display: none;
        }

        .choice-mode .button-container {
            display: none;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .question {
                font-size: 28px;
            }
            
            .answer-input {
                width: 100px;
                height: 55px;
                font-size: 24px;
            }
            
            .btn, .option-btn {
                height: 55px;
                font-size: 16px;
            }

            .difficulty-btn, .subject-btn {
                height: 45px;
                font-size: 13px;
            }

            .subject-btn {
                height: 55px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ¯ å°å­¦ä¸€å¹´çº§å­¦ä¹ æ¸¸æˆ</h1>
        </div>

        <div class="subject-selector">
            <button class="subject-btn math active" data-subject="math">
                ğŸ”¢<br>æ•°å­¦è®¡ç®—
            </button>
            <button class="subject-btn chinese" data-subject="chinese">
                ğŸ“š<br>è¯­æ–‡è¯†å­—
            </button>
            <button class="subject-btn english" data-subject="english">
                ğŸŒ<br>è‹±è¯­å•è¯
            </button>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn easy active" data-difficulty="easy">
                ğŸŸ¢ ç®€å•<br><span id="difficultyDesc">50ä»¥å†…</span>
            </button>
            <button class="difficulty-btn medium" data-difficulty="medium">
                ğŸŸ¡ ä¸­ç­‰<br><span id="difficultyDesc2">100ä»¥å†…</span>
            </button>
            <button class="difficulty-btn hard" data-difficulty="hard">
                ğŸ”´ å›°éš¾<br><span id="difficultyDesc3">1000ä»¥å†…</span>
            </button>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">ğŸ“Š æ€»é¢˜æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="unansweredCount">0</div>
                <div class="stat-label">â³ æœªç­”</div>
            </div>
            <div class="stat-card correct">
                <div class="stat-number" id="correctCount">0</div>
                <div class="stat-label">âœ… ç­”å¯¹</div>
            </div>
            <div class="stat-card incorrect">
                <div class="stat-number" id="incorrectCount">0</div>
                <div class="stat-label">âŒ ç­”é”™</div>
            </div>
        </div>

        <div class="question-container" id="questionContainer">
            <div class="streak-indicator" id="streakIndicator" style="display: none;">
                ğŸ”¥ è¿å¯¹ <span id="streakCount">0</span> é¢˜
            </div>
            <div class="question" id="question">é€‰æ‹©ç§‘ç›®å’Œéš¾åº¦ï¼Œç„¶åå¼€å§‹ç»ƒä¹ å§ï¼</div>
            
            <!-- æ•°å­¦æ¨¡å¼çš„è¾“å…¥æ¡† -->
            <div class="input-container">
                <input type="number" id="answerInput" class="answer-input" placeholder="?" disabled>
            </div>

            <!-- é€‰æ‹©é¢˜æ¨¡å¼çš„é€‰é¡¹ -->
            <div class="options-container" id="optionsContainer">
                <button class="option-btn" data-option="0"></button>
                <button class="option-btn" data-option="1"></button>
                <button class="option-btn" data-option="2"></button>
                <button class="option-btn" data-option="3"></button>
            </div>

            <div class="button-container">
                <button id="submitBtn" class="btn btn-submit" disabled>ğŸ¯ æäº¤ç­”æ¡ˆ</button>
                <button id="nextBtn" class="btn btn-next" disabled>â¡ï¸ ä¸‹ä¸€é¢˜</button>
            </div>
        </div>

        <div class="controls">
            <button id="startBtn" class="btn-control">ğŸš€ å¼€å§‹ç»ƒä¹ </button>
            <button id="resetBtn" class="btn-control">ğŸ”„ é‡æ–°å¼€å§‹</button>
        </div>

        <div id="feedback" class="feedback ready-message">
            é€‰æ‹©ç§‘ç›®å’Œéš¾åº¦ï¼Œç„¶åç‚¹å‡»"å¼€å§‹ç»ƒä¹ "å§ï¼ğŸ’ª
        </div>
    </div>

    <script>
        class LearningGame {
            constructor() {
                this.questions = [];
                this.currentIndex = 0;
                this.stats = {
                    correct: 0,
                    incorrect: 0,
                    total: 0,
                    unanswered: 0,
                    streak: 0,
                    maxStreak: 0
                };
                this.isGameActive = false;
                this.currentDifficulty = 'easy';
                this.currentSubject = 'math';
                this.selectedOption = null;
                this.autoNextTimeout = null;
                this.initElements();
                this.bindEvents();
                this.generateQuestions();
                this.updateStats();
                this.updateDifficultyDescriptions();
                this.updateGameMode();
                this.initAudio();
            }

            initElements() {
                this.questionEl = document.getElementById('question');
                this.answerInput = document.getElementById('answerInput');
                this.submitBtn = document.getElementById('submitBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.startBtn = document.getElementById('startBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.feedback = document.getElementById('feedback');
                this.totalCountEl = document.getElementById('totalCount');
                this.correctCountEl = document.getElementById('correctCount');
                this.incorrectCountEl = document.getElementById('incorrectCount');
                this.unansweredCountEl = document.getElementById('unansweredCount');
                this.streakIndicator = document.getElementById('streakIndicator');
                this.streakCountEl = document.getElementById('streakCount');
                this.questionContainer = document.getElementById('questionContainer');
                this.optionsContainer = document.getElementById('optionsContainer');
                this.optionBtns = document.querySelectorAll('.option-btn');
            }

            initAudio() {
                this.audioContext = null;
                this.initAudioContext = () => {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                };
            }

            playSound(frequency, duration, type = 'success') {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                if (type === 'success') {
                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.5, this.audioContext.currentTime + duration);
                } else {
                    oscillator.frequency.setValueAtTime(frequency * 0.7, this.audioContext.currentTime);
                }
                
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            bindEvents() {
                this.submitBtn.addEventListener('click', () => {
                    this.initAudioContext();
                    this.submitAnswer();
                });
                this.nextBtn.addEventListener('click', () => this.nextQuestion());
                this.startBtn.addEventListener('click', () => {
                    this.initAudioContext();
                    this.startGame();
                });
                this.resetBtn.addEventListener('click', () => this.resetGame());
                
                // ç§‘ç›®é€‰æ‹©
                document.querySelectorAll('.subject-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.subject-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentSubject = btn.dataset.subject;
                        this.generateQuestions();
                        this.updateStats();
                        this.updateDifficultyDescriptions();
                        this.updateGameMode();
                    });
                });

                // éš¾åº¦é€‰æ‹©
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentDifficulty = btn.dataset.difficulty;
                        this.generateQuestions();
                        this.updateStats();
                    });
                });

                // é€‰é¡¹æŒ‰é’®
                this.optionBtns.forEach((btn, index) => {
                    btn.addEventListener('click', () => {
                        this.selectOption(index);
                    });
                });
                
                this.answerInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !this.submitBtn.disabled) {
                        this.initAudioContext();
                        this.submitAnswer();
                    }
                });
            }

            updateGameMode() {
                if (this.currentSubject === 'math') {
                    this.questionContainer.className = 'question-container math-mode';
                } else {
                    this.questionContainer.className = 'question-container choice-mode';
                }
            }

            updateDifficultyDescriptions() {
                const descriptions = {
                    math: {
                        easy: '50ä»¥å†…',
                        medium: '100ä»¥å†…',
                        hard: '1000ä»¥å†…'
                    },
                    chinese: {
                        easy: 'åŸºç¡€å­—',
                        medium: 'å¸¸ç”¨å­—',
                        hard: 'å¤æ‚å­—'
                    },
                    english: {
                        easy: 'ç®€å•è¯',
                        medium: 'å¸¸ç”¨è¯',
                        hard: 'è¿›é˜¶è¯'
                    }
                };

                document.getElementById('difficultyDesc').textContent = descriptions[this.currentSubject].easy;
                document.getElementById('difficultyDesc2').textContent = descriptions[this.currentSubject].medium;
                document.getElementById('difficultyDesc3').textContent = descriptions[this.currentSubject].hard;
            }

            selectOption(index) {
                // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
                this.optionBtns.forEach(btn => btn.classList.remove('selected'));
                
                // é€‰æ‹©å½“å‰é€‰é¡¹
                this.optionBtns[index].classList.add('selected');
                this.selectedOption = index;
                
                // è‡ªåŠ¨æäº¤ç­”æ¡ˆï¼ˆ500æ¯«ç§’å»¶è¿Ÿï¼‰
                if (this.autoNextTimeout) {
                    clearTimeout(this.autoNextTimeout);
                }
                
                this.autoNextTimeout = setTimeout(() => {
                    this.submitAnswer();
                }, 500);
            }

            generateQuestions() {
                this.questions = [];
                
                if (this.currentSubject === 'math') {
                    this.generateMathQuestions();
                } else if (this.currentSubject === 'chinese') {
                    this.generateChineseQuestions();
                } else {
                    this.generateEnglishQuestions();
                }
                
                // æ‰“ä¹±é¡ºåº
                for (let i = this.questions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.questions[i], this.questions[j]] = [this.questions[j], this.questions[i]];
                }
                
                this.stats.total = this.questions.length;
                this.stats.unanswered = this.questions.length;
            }

            generateMathQuestions() {
                let maxNum, questionCount;
                
                switch (this.currentDifficulty) {
                    case 'easy':
                        maxNum = 50;
                        questionCount = 20;
                        break;
                    case 'medium':
                        maxNum = 100;
                        questionCount = 25;
                        break;
                    case 'hard':
                        maxNum = 1000;
                        questionCount = 30;
                        break;
                }
                
                // ç”ŸæˆåŠ æ³•é¢˜
                for (let i = 0; i < questionCount / 2; i++) {
                    const a = Math.floor(Math.random() * maxNum) + 1;
                    const b = Math.floor(Math.random() * (maxNum - a)) + 1;
                    this.questions.push({
                        question: `${a} + ${b} = `,
                        answer: a + b,
                        type: 'input',
                        answered: false,
                        correct: null
                    });
                }
                
                // ç”Ÿæˆå‡æ³•é¢˜
                for (let i = 0; i < questionCount / 2; i++) {
                    const a = Math.floor(Math.random() * maxNum) + 2;
                    const b = Math.floor(Math.random() * a) + 1;
                    this.questions.push({
                        question: `${a} - ${b} = `,
                        answer: a - b,
                        type: 'input',
                        answered: false,
                        correct: null
                    });
                }
            }

            generateChineseQuestions() {
                const characterSets = {
                    easy: [
                        {char: 'ä¸€', pinyin: 'yÄ«'}, {char: 'äºŒ', pinyin: 'Ã¨r'}, {char: 'ä¸‰', pinyin: 'sÄn'},
                        {char: 'å››', pinyin: 'sÃ¬'}, {char: 'äº”', pinyin: 'wÇ”'}, {char: 'å…­', pinyin: 'liÃ¹'},
                        {char: 'ä¸ƒ', pinyin: 'qÄ«'}, {char: 'å…«', pinyin: 'bÄ'}, {char: 'ä¹', pinyin: 'jiÇ”'},
                        {char: 'å', pinyin: 'shÃ­'}, {char: 'å¤§', pinyin: 'dÃ '}, {char: 'å°', pinyin: 'xiÇo'},
                        {char: 'äºº', pinyin: 'rÃ©n'}, {char: 'å£', pinyin: 'kÇ’u'}, {char: 'æ‰‹', pinyin: 'shÇ’u'}
                    ],
                    medium: [
                        {char: 'å­¦', pinyin: 'xuÃ©'}, {char: 'æ ¡', pinyin: 'xiÃ o'}, {char: 'è€', pinyin: 'lÇo'},
                        {char: 'å¸ˆ', pinyin: 'shÄ«'}, {char: 'åŒ', pinyin: 'tÃ³ng'}, {char: 'å­¦', pinyin: 'xuÃ©'},
                        {char: 'æœ‹', pinyin: 'pÃ©ng'}, {char: 'å‹', pinyin: 'yÇ’u'}, {char: 'å®¶', pinyin: 'jiÄ'},
                        {char: 'çˆ¸', pinyin: 'bÃ '}, {char: 'å¦ˆ', pinyin: 'mÄ'}, {char: 'å“¥', pinyin: 'gÄ“'},
                        {char: 'å§', pinyin: 'jiÄ›'}, {char: 'å¼Ÿ', pinyin: 'dÃ¬'}, {char: 'å¦¹', pinyin: 'mÃ¨i'}
                    ],
                    hard: [
                        {char: 'æ¼‚', pinyin: 'piÃ o'}, {char: 'äº®', pinyin: 'liÃ ng'}, {char: 'èª', pinyin: 'cÅng'},
                        {char: 'æ˜', pinyin: 'mÃ­ng'}, {char: 'å‹‡', pinyin: 'yÇ’ng'}, {char: 'æ•¢', pinyin: 'gÇn'},
                        {char: 'æ¸©', pinyin: 'wÄ“n'}, {char: 'æŸ”', pinyin: 'rÃ³u'}, {char: 'å–„', pinyin: 'shÃ n'},
                        {char: 'è‰¯', pinyin: 'liÃ¡ng'}, {char: 'è¯š', pinyin: 'chÃ©ng'}, {char: 'å®', pinyin: 'shÃ­'},
                        {char: 'åŠª', pinyin: 'nÇ”'}, {char: 'åŠ›', pinyin: 'lÃ¬'}, {char: 'è¿›', pinyin: 'jÃ¬n'}
                    ]
                };

                const characters = characterSets[this.currentDifficulty];
                const questionCount = this.currentDifficulty === 'easy' ? 15 : 
                                     this.currentDifficulty === 'medium' ? 20 : 25;

                for (let i = 0; i < questionCount; i++) {
                    const randomChar = characters[Math.floor(Math.random() * characters.length)];
                    const otherChars = characters.filter(c => c !== randomChar);
                    
                    if (Math.random() > 0.5) {
                        // çœ‹æ±‰å­—é€‰æ‹¼éŸ³
                        const options = [randomChar.pinyin];
                        while (options.length < 4) {
                            const randomOther = otherChars[Math.floor(Math.random() * otherChars.length)];
                            if (!options.includes(randomOther.pinyin)) {
                                options.push(randomOther.pinyin);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `"${randomChar.char}" çš„æ‹¼éŸ³æ˜¯ï¼Ÿ`,
                            answer: randomChar.pinyin,
                            options: options,
                            correctIndex: options.indexOf(randomChar.pinyin),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    } else {
                        // çœ‹æ‹¼éŸ³é€‰æ±‰å­—
                        const options = [randomChar.char];
                        while (options.length < 4) {
                            const randomOther = otherChars[Math.floor(Math.random() * otherChars.length)];
                            if (!options.includes(randomOther.char)) {
                                options.push(randomOther.char);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `æ‹¼éŸ³ "${randomChar.pinyin}" å¯¹åº”çš„æ±‰å­—æ˜¯ï¼Ÿ`,
                            answer: randomChar.char,
                            options: options,
                            correctIndex: options.indexOf(randomChar.char),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    }
                }
            }

            generateEnglishQuestions() {
                const wordSets = {
                    easy: [
                        {english: 'cat', chinese: 'çŒ«'}, {english: 'dog', chinese: 'ç‹—'}, {english: 'book', chinese: 'ä¹¦'},
                        {english: 'pen', chinese: 'ç¬”'}, {english: 'apple', chinese: 'è‹¹æœ'}, {english: 'water', chinese: 'æ°´'},
                        {english: 'milk', chinese: 'ç‰›å¥¶'}, {english: 'bread', chinese: 'é¢åŒ…'}, {english: 'fish', chinese: 'é±¼'},
                        {english: 'bird', chinese: 'é¸Ÿ'}, {english: 'tree', chinese: 'æ ‘'}, {english: 'flower', chinese: 'èŠ±'},
                        {english: 'sun', chinese: 'å¤ªé˜³'}, {english: 'moon', chinese: 'æœˆäº®'}, {english: 'star', chinese: 'æ˜Ÿæ˜Ÿ'}
                    ],
                    medium: [
                        {english: 'school', chinese: 'å­¦æ ¡'}, {english: 'teacher', chinese: 'è€å¸ˆ'}, {english: 'student', chinese: 'å­¦ç”Ÿ'},
                        {english: 'family', chinese: 'å®¶åº­'}, {english: 'mother', chinese: 'å¦ˆå¦ˆ'}, {english: 'father', chinese: 'çˆ¸çˆ¸'},
                        {english: 'friend', chinese: 'æœ‹å‹'}, {english: 'happy', chinese: 'å¿«ä¹'}, {english: 'beautiful', chinese: 'ç¾ä¸½'},
                        {english: 'smart', chinese: 'èªæ˜'}, {english: 'kind', chinese: 'å–„è‰¯'}, {english: 'brave', chinese: 'å‹‡æ•¢'},
                        {english: 'strong', chinese: 'å¼ºå£®'}, {english: 'fast', chinese: 'å¿«é€Ÿ'}, {english: 'slow', chinese: 'ç¼“æ…¢'}
                    ],
                    hard: [
                        {english: 'rainbow', chinese: 'å½©è™¹'}, {english: 'butterfly', chinese: 'è´è¶'}, {english: 'elephant', chinese: 'å¤§è±¡'},
                        {english: 'mountain', chinese: 'å±±'}, {english: 'ocean', chinese: 'æµ·æ´‹'}, {english: 'forest', chinese: 'æ£®æ—'},
                        {english: 'adventure', chinese: 'å†’é™©'}, {english: 'wonderful', chinese: 'ç²¾å½©'}, {english: 'imagination', chinese: 'æƒ³è±¡'},
                        {english: 'discovery', chinese: 'å‘ç°'}, {english: 'treasure', chinese: 'å®è—'}, {english: 'mystery', chinese: 'ç¥ç§˜'},
                        {english: 'journey', chinese: 'æ—…ç¨‹'}, {english: 'fantastic', chinese: 'å¥‡å¦™'}, {english: 'magical', chinese: 'é­”æ³•'}
                    ]
                };

                const words = wordSets[this.currentDifficulty];
                const questionCount = this.currentDifficulty === 'easy' ? 15 : 
                                     this.currentDifficulty === 'medium' ? 20 : 25;

                for (let i = 0; i < questionCount; i++) {
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    const otherWords = words.filter(w => w !== randomWord);
                    
                    if (Math.random() > 0.5) {
                        // çœ‹è‹±è¯­é€‰ä¸­æ–‡
                        const options = [randomWord.chinese];
                        while (options.length < 4) {
                            const randomOther = otherWords[Math.floor(Math.random() * otherWords.length)];
                            if (!options.includes(randomOther.chinese)) {
                                options.push(randomOther.chinese);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `"${randomWord.english}" çš„ä¸­æ–‡æ„æ€æ˜¯ï¼Ÿ`,
                            answer: randomWord.chinese,
                            options: options,
                            correctIndex: options.indexOf(randomWord.chinese),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    } else {
                        // çœ‹ä¸­æ–‡é€‰è‹±è¯­
                        const options = [randomWord.english];
                        while (options.length < 4) {
                            const randomOther = otherWords[Math.floor(Math.random() * otherWords.length)];
                            if (!options.includes(randomOther.english)) {
                                options.push(randomOther.english);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `"${randomWord.chinese}" çš„è‹±è¯­å•è¯æ˜¯ï¼Ÿ`,
                            answer: randomWord.english,
                            options: options,
                            correctIndex: options.indexOf(randomWord.english),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    }
                }
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            startGame() {
                this.isGameActive = true;
                this.currentIndex = 0;
                this.stats.streak = 0;
                this.selectedOption = null;
                
                if (this.currentSubject === 'math') {
                    this.answerInput.disabled = false;
                    this.submitBtn.disabled = false;
                } else {
                    this.resetOptionButtons();
                }
                
                this.startBtn.textContent = 'â¸ï¸ æš‚åœ';
                this.showCurrentQuestion();
                
                if (this.currentSubject === 'math') {
                    this.answerInput.focus();
                }
            }

            showCurrentQuestion() {
                if (this.currentIndex < this.questions.length) {
                    const current = this.questions[this.currentIndex];
                    this.questionEl.textContent = current.question;
                    
                    if (current.type === 'input') {
                        this.answerInput.value = '';
                        this.nextBtn.disabled = true;
                        this.submitBtn.disabled = false;
                    } else {
                        // é€‰æ‹©é¢˜æ¨¡å¼
                        this.resetOptionButtons();
                        current.options.forEach((option, index) => {
                            this.optionBtns[index].textContent = option;
                        });
                        this.selectedOption = null;
                    }
                    
                    this.feedback.className = 'feedback';
                    this.feedback.textContent = this.currentSubject === 'math' ? 'è¯·è¾“å…¥ç­”æ¡ˆ ğŸ¤”' : 'è¯·é€‰æ‹©ç­”æ¡ˆ ğŸ¤”';
                    
                    // æ¸…é™¤è‡ªåŠ¨ä¸‹ä¸€é¢˜çš„å®šæ—¶å™¨
                    if (this.autoNextTimeout) {
                        clearTimeout(this.autoNextTimeout);
                        this.autoNextTimeout = null;
                    }
                } else {
                    this.endGame();
                }
            }

            resetOptionButtons() {
                this.optionBtns.forEach(btn => {
                    btn.classList.remove('selected', 'correct', 'incorrect');
                    btn.disabled = false;
                });
            }

            submitAnswer() {
                const current = this.questions[this.currentIndex];
                let userAnswer, isCorrect;

                if (current.type === 'input') {
                    userAnswer = parseInt(this.answerInput.value);
                    if (isNaN(userAnswer)) {
                        this.showFeedback('è¯·è¾“å…¥ä¸€ä¸ªæ•°å­—ï¼', 'incorrect');
                        return;
                    }
                    isCorrect = userAnswer === current.answer;
                } else {
                    if (this.selectedOption === null) {
                        this.showFeedback('è¯·é€‰æ‹©ä¸€ä¸ªç­”æ¡ˆï¼', 'incorrect');
                        return;
                    }
                    isCorrect = this.selectedOption === current.correctIndex;
                    
                    // æ˜¾ç¤ºé€‰æ‹©é¢˜ç»“æœ
                    this.optionBtns.forEach((btn, index) => {
                        btn.disabled = true;
                        if (index === current.correctIndex) {
                            btn.classList.add('correct');
                        } else if (index === this.selectedOption && !isCorrect) {
                            btn.classList.add('incorrect');
                        }
                    });
                }

                current.answered = true;
                this.stats.unanswered--;
                
                if (isCorrect) {
                    current.correct = true;
                    this.stats.correct++;
                    this.stats.streak++;
                    this.stats.maxStreak = Math.max(this.stats.maxStreak, this.stats.streak);
                    
                    const encouragement = this.getEncouragement();
                    this.showFeedback(`ğŸ‰ ${encouragement}`, 'correct');
                    this.showCelebration();
                    this.playSound(523.25, 0.3, 'success');
                    
                    // 500æ¯«ç§’åè‡ªåŠ¨ä¸‹ä¸€é¢˜
                    this.autoNextTimeout = setTimeout(() => {
                        this.nextQuestion();
                    }, 500);
                } else {
                    current.correct = false;
                    this.stats.incorrect++;
                    this.stats.streak = 0;
                    this.showFeedback(`âŒ ç­”é”™äº†ï¼Œæ­£ç¡®ç­”æ¡ˆæ˜¯ ${current.answer}ï¼Œå†æ¥å†å‰ï¼`, 'incorrect');
                    this.playSound(196, 0.5, 'error');
                    
                    // é”™è¯¯æ—¶å»¶è¿Ÿæ›´é•¿æ—¶é—´å†è¿›å…¥ä¸‹ä¸€é¢˜
                    this.autoNextTimeout = setTimeout(() => {
                        this.nextQuestion();
                    }, 1500);
                }

                if (current.type === 'input') {
                    this.submitBtn.disabled = true;
                    this.nextBtn.disabled = false;
                }
                
                this.updateStats();
                this.updateStreakDisplay();
            }

            getEncouragement() {
                const encouragements = [
                    'å¤ªæ£’äº†ï¼', 'ç­”å¯¹äº†ï¼', 'çœŸèªæ˜ï¼', 'å¾ˆæ£’ï¼', 'ç»§ç»­åŠ æ²¹ï¼',
                    'ä½ çœŸå‰å®³ï¼', 'å®Œç¾ï¼', 'ä¼˜ç§€ï¼', 'å¥½æ ·çš„ï¼', 'çœŸä¸é”™ï¼'
                ];
                return encouragements[Math.floor(Math.random() * encouragements.length)];
            }

            updateStreakDisplay() {
                if (this.stats.streak >= 3) {
                    this.streakIndicator.style.display = 'block';
                    this.streakCountEl.textContent = this.stats.streak;
                } else {
                    this.streakIndicator.style.display = 'none';
                }
            }

            nextQuestion() {
                if (this.autoNextTimeout) {
                    clearTimeout(this.autoNextTimeout);
                    this.autoNextTimeout = null;
                }
                this.currentIndex++;
                this.showCurrentQuestion();
            }

            showFeedback(message, type) {
                this.feedback.textContent = message;
                this.feedback.className = `feedback ${type}`;
            }

            showCelebration() {
                const emojis = ['ğŸŒŸ', 'ğŸ‰', 'ğŸŠ', 'â­', 'âœ¨', 'ğŸ†', 'ğŸ‘', 'ğŸ¥³'];
                const celebration = document.createElement('div');
                celebration.className = 'celebration';
                celebration.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                document.body.appendChild(celebration);
                
                setTimeout(() => {
                    if (document.body.contains(celebration)) {
                        document.body.removeChild(celebration);
                    }
                }, 800);
            }

            updateStats() {
                this.totalCountEl.textContent = this.stats.total;
                this.correctCountEl.textContent = this.stats.correct;
                this.incorrectCountEl.textContent = this.stats.incorrect;
                this.unansweredCountEl.textContent = this.stats.unanswered;
            }

            endGame() {
                this.isGameActive = false;
                const accuracy = Math.round((this.stats.correct / this.stats.total) * 100);
                let message = `ğŸŠ æ¸¸æˆç»“æŸï¼\nç­”å¯¹äº† ${this.stats.correct} é¢˜ï¼Œç­”é”™äº† ${this.stats.incorrect} é¢˜\næ­£ç¡®ç‡ï¼š${accuracy}%\næœ€é«˜è¿å‡»ï¼š${this.stats.maxStreak} é¢˜`;
                
                if (accuracy >= 90) {
                    message += '\nğŸ† å¤ªå‰å®³äº†ï¼ä½ æ˜¯å­¦ä¹ å°å¤©æ‰ï¼';
                } else if (accuracy >= 80) {
                    message += '\nğŸŒŸ å¾ˆæ£’ï¼ç»§ç»­åŠªåŠ›å“¦ï¼';
                } else if (accuracy >= 70) {
                    message += '\nğŸ’ª ä¸é”™ï¼å¤šç»ƒä¹ ä¼šæ›´å¥½çš„ï¼';
                } else {
                    message += '\nğŸ¤— æ²¡å…³ç³»ï¼Œå¤šç»ƒä¹ å°±ä¼šè¿›æ­¥çš„ï¼';
                }

                this.feedback.textContent = message;
                this.feedback.className = 'feedback ready-message';
                this.questionEl.textContent = 'ç‚¹å‡»é‡æ–°å¼€å§‹ç»§ç»­ç»ƒä¹ ï¼';
                
                if (this.currentSubject === 'math') {
                    this.answerInput.disabled = true;
                    this.submitBtn.disabled = true;
                    this.nextBtn.disabled = true;
                } else {
                    this.optionBtns.forEach(btn => btn.disabled = true);
                }
                
                this.startBtn.textContent = 'ğŸš€ å¼€å§‹ç»ƒä¹ ';
            }

            resetGame() {
                this.currentIndex = 0;
                this.stats = { correct: 0, incorrect: 0, total: 0, unanswered: 0, streak: 0, maxStreak: 0 };
                this.isGameActive = false;
                this.selectedOption = null;
                
                if (this.autoNextTimeout) {
                    clearTimeout(this.autoNextTimeout);
                    this.autoNextTimeout = null;
                }
                
                this.generateQuestions();
                this.updateStats();
                this.questionEl.textContent = 'é€‰æ‹©ç§‘ç›®å’Œéš¾åº¦ï¼Œç„¶åå¼€å§‹ç»ƒä¹ å§ï¼';
                this.answerInput.value = '';
                this.answerInput.disabled = true;
                this.submitBtn.disabled = true;
                this.nextBtn.disabled = true;
                this.resetOptionButtons();
                this.startBtn.textContent = 'ğŸš€ å¼€å§‹ç»ƒä¹ ';
                this.feedback.textContent = 'é€‰æ‹©ç§‘ç›®å’Œéš¾åº¦ï¼Œç„¶åç‚¹å‡»"å¼€å§‹ç»ƒä¹ "å§ï¼ğŸ’ª';
                this.feedback.className = 'feedback ready-message';
                this.streakIndicator.style.display = 'none';
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            new LearningGame();
        });
    </script>
</body>
</html>
