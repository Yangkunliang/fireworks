<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Â∞èÂ≠¶‰∏ÄÂπ¥Á∫ßÂ≠¶‰π†Ê∏∏Êàè</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .title {
            font-size: 24px;
            color: #ff6b6b;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subject-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .subject-btn {
            height: 60px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .subject-btn.math {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
        }

        .subject-btn.chinese {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .subject-btn.english {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .subject-btn.active {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .difficulty-selector {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            height: 50px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .difficulty-btn.easy {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .difficulty-btn.medium {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
        }

        .difficulty-btn.hard {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .difficulty-btn.active {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            border: 3px solid #fff;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
        }

        .stat-card.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393);
        }

        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .stat-label {
            font-size: 14px;
            color: #fff;
            font-weight: bold;
            margin-top: 5px;
        }

        .question-container {
            background: linear-gradient(135deg, #a8e6cf, #88d8c0);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
            border: 4px solid #fff;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .question {
            font-size: 32px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .input-container {
            margin-bottom: 20px;
        }

        .answer-input {
            width: 120px;
            height: 60px;
            font-size: 28px;
            font-weight: bold;
            text-align: center;
            border: 4px solid #74b9ff;
            border-radius: 15px;
            background: #fff;
            color: #2d3436;
            box-shadow: inset 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .answer-input:focus {
            outline: none;
            border-color: #0984e3;
            box-shadow: 0 0 20px rgba(116, 185, 255, 0.5);
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        /* ÈÄâÊã©È¢òÈÄâÈ°π */
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            height: 60px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #ddd6fe, #c4b5fd);
            color: #2d3436;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.15);
        }

        .option-btn:active {
            transform: translateY(0);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            transform: scale(1.05);
        }

        .option-btn.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            animation: correctPulse 0.6s ease;
        }

        .option-btn.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            animation: incorrectShake 0.6s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes incorrectShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .button-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            height: 60px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .btn-submit {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #00a085, #008f7a);
            transform: translateY(-2px);
        }

        .btn-next {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
        }

        .btn-next:hover {
            background: linear-gradient(135deg, #0984e3, #0770c4);
            transform: translateY(-2px);
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-control {
            height: 50px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #fd79a8, #fdcb6e);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-control:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
        }

        .feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            transition: all 0.3s ease;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #55efc4, #00b894);
            color: white;
            border: 3px solid #00a085;
        }

        .feedback.incorrect {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            border: 3px solid #d63384;
        }

        .ready-message {
            background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
            color: #2d3436;
            border: 3px solid #e17055;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            z-index: 1000;
            animation: celebrate 0.8s ease-out;
            pointer-events: none;
        }

        @keyframes celebrate {
            0% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 1;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.2) rotate(180deg);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) rotate(360deg);
                opacity: 0;
            }
        }

        .streak-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ff9ff3, #f368e0);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        /* ÈöêËóèÊï∞Â≠¶ËæìÂÖ•Ê°Ü */
        .math-mode .options-container {
            display: none;
        }

        .choice-mode .input-container {
            display: none;
        }

        .choice-mode .button-container {
            display: none;
        }

        /* ÂìçÂ∫îÂºè‰ºòÂåñ */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .question {
                font-size: 28px;
            }
            
            .answer-input {
                width: 100px;
                height: 55px;
                font-size: 24px;
            }
            
            .btn, .option-btn {
                height: 55px;
                font-size: 16px;
            }

            .difficulty-btn, .subject-btn {
                height: 45px;
                font-size: 13px;
            }

            .subject-btn {
                height: 55px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">üéØ Â∞èÂ≠¶‰∏ÄÂπ¥Á∫ßÂ≠¶‰π†Ê∏∏Êàè</h1>
        </div>

        <div class="subject-selector">
            <button class="subject-btn math active" data-subject="math">
                üî¢<br>Êï∞Â≠¶ËÆ°ÁÆó
            </button>
            <button class="subject-btn chinese" data-subject="chinese">
                üìö<br>ËØ≠ÊñáËØÜÂ≠ó
            </button>
            <button class="subject-btn english" data-subject="english">
                üåç<br>Ëã±ËØ≠ÂçïËØç
            </button>
        </div>

        <div class="difficulty-selector">
            <button class="difficulty-btn easy active" data-difficulty="easy">
                üü¢ ÁÆÄÂçï<br><span id="difficultyDesc">50‰ª•ÂÜÖ</span>
            </button>
            <button class="difficulty-btn medium" data-difficulty="medium">
                üü° ‰∏≠Á≠â<br><span id="difficultyDesc2">100‰ª•ÂÜÖ</span>
            </button>
            <button class="difficulty-btn hard" data-difficulty="hard">
                üî¥ Âõ∞Èöæ<br><span id="difficultyDesc3">1000‰ª•ÂÜÖ</span>
            </button>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-number" id="totalCount">0</div>
                <div class="stat-label">üìä ÊÄªÈ¢òÊï∞</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="unansweredCount">0</div>
                <div class="stat-label">‚è≥ Êú™Á≠î</div>
            </div>
            <div class="stat-card correct">
                <div class="stat-number" id="correctCount">0</div>
                <div class="stat-label">‚úÖ Á≠îÂØπ</div>
            </div>
            <div class="stat-card incorrect">
                <div class="stat-number" id="incorrectCount">0</div>
                <div class="stat-label">‚ùå Á≠îÈîô</div>
            </div>
        </div>

        <div class="question-container" id="questionContainer">
            <div class="streak-indicator" id="streakIndicator" style="display: none;">
                üî• ËøûÂØπ <span id="streakCount">0</span> È¢ò
            </div>
            <div class="question" id="question">ÈÄâÊã©ÁßëÁõÆÂíåÈöæÂ∫¶ÔºåÁÑ∂ÂêéÂºÄÂßãÁªÉ‰π†ÂêßÔºÅ</div>
            
            <!-- Êï∞Â≠¶Ê®°ÂºèÁöÑËæìÂÖ•Ê°Ü -->
            <div class="input-container">
                <input type="number" id="answerInput" class="answer-input" placeholder="?" disabled>
            </div>

            <!-- ÈÄâÊã©È¢òÊ®°ÂºèÁöÑÈÄâÈ°π -->
            <div class="options-container" id="optionsContainer">
                <button class="option-btn" data-option="0"></button>
                <button class="option-btn" data-option="1"></button>
                <button class="option-btn" data-option="2"></button>
                <button class="option-btn" data-option="3"></button>
            </div>

            <div class="button-container">
                <button id="submitBtn" class="btn btn-submit" disabled>üéØ Êèê‰∫§Á≠îÊ°à</button>
                <button id="nextBtn" class="btn btn-next" disabled>‚û°Ô∏è ‰∏ã‰∏ÄÈ¢ò</button>
            </div>
        </div>

        <div class="controls">
            <button id="startBtn" class="btn-control">üöÄ ÂºÄÂßãÁªÉ‰π†</button>
            <button id="resetBtn" class="btn-control">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
        </div>

        <div id="feedback" class="feedback ready-message">
            ÈÄâÊã©ÁßëÁõÆÂíåÈöæÂ∫¶ÔºåÁÑ∂ÂêéÁÇπÂáª"ÂºÄÂßãÁªÉ‰π†"ÂêßÔºÅüí™
        </div>
    </div>

    <script>
        class LearningGame {
            constructor() {
                this.questions = [];
                this.currentIndex = 0;
                this.stats = {
                    correct: 0,
                    incorrect: 0,
                    total: 0,
                    unanswered: 0,
                    streak: 0,
                    maxStreak: 0
                };
                this.isGameActive = false;
                this.currentDifficulty = 'easy';
                this.currentSubject = 'math';
                this.selectedOption = null;
                this.autoNextTimeout = null;
                this.initElements();
                this.bindEvents();
                this.generateQuestions();
                this.updateStats();
                this.updateDifficultyDescriptions();
                this.updateGameMode();
                this.initAudio();
            }

            initElements() {
                this.questionEl = document.getElementById('question');
                this.answerInput = document.getElementById('answerInput');
                this.submitBtn = document.getElementById('submitBtn');
                this.nextBtn = document.getElementById('nextBtn');
                this.startBtn = document.getElementById('startBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.feedback = document.getElementById('feedback');
                this.totalCountEl = document.getElementById('totalCount');
                this.correctCountEl = document.getElementById('correctCount');
                this.incorrectCountEl = document.getElementById('incorrectCount');
                this.unansweredCountEl = document.getElementById('unansweredCount');
                this.streakIndicator = document.getElementById('streakIndicator');
                this.streakCountEl = document.getElementById('streakCount');
                this.questionContainer = document.getElementById('questionContainer');
                this.optionsContainer = document.getElementById('optionsContainer');
                this.optionBtns = document.querySelectorAll('.option-btn');
            }

            initAudio() {
                this.audioContext = null;
                this.initAudioContext = () => {
                    if (!this.audioContext) {
                        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                };
            }

            playSound(frequency, duration, type = 'success') {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                if (type === 'success') {
                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.5, this.audioContext.currentTime + duration);
                } else {
                    oscillator.frequency.setValueAtTime(frequency * 0.7, this.audioContext.currentTime);
                }
                
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }

            bindEvents() {
                this.submitBtn.addEventListener('click', () => {
                    this.initAudioContext();
                    this.submitAnswer();
                });
                this.nextBtn.addEventListener('click', () => this.nextQuestion());
                this.startBtn.addEventListener('click', () => {
                    this.initAudioContext();
                    this.startGame();
                });
                this.resetBtn.addEventListener('click', () => this.resetGame());
                
                // ÁßëÁõÆÈÄâÊã©
                document.querySelectorAll('.subject-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.subject-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentSubject = btn.dataset.subject;
                        this.generateQuestions();
                        this.updateStats();
                        this.updateDifficultyDescriptions();
                        this.updateGameMode();
                    });
                });

                // ÈöæÂ∫¶ÈÄâÊã©
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        this.currentDifficulty = btn.dataset.difficulty;
                        this.generateQuestions();
                        this.updateStats();
                    });
                });

                // ÈÄâÈ°πÊåâÈíÆ
                this.optionBtns.forEach((btn, index) => {
                    btn.addEventListener('click', () => {
                        this.selectOption(index);
                    });
                });
                
                this.answerInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !this.submitBtn.disabled) {
                        this.initAudioContext();
                        this.submitAnswer();
                    }
                });
            }

            updateGameMode() {
                if (this.currentSubject === 'math') {
                    this.questionContainer.className = 'question-container math-mode';
                } else {
                    this.questionContainer.className = 'question-container choice-mode';
                }
            }

            updateDifficultyDescriptions() {
                const descriptions = {
                    math: {
                        easy: '50‰ª•ÂÜÖ',
                        medium: '100‰ª•ÂÜÖ',
                        hard: '1000‰ª•ÂÜÖ'
                    },
                    chinese: {
                        easy: 'Âü∫Á°ÄÂ≠ó',
                        medium: 'Â∏∏Áî®Â≠ó',
                        hard: 'Â§çÊùÇÂ≠ó'
                    },
                    english: {
                        easy: 'ÁÆÄÂçïËØç',
                        medium: 'Â∏∏Áî®ËØç',
                        hard: 'ËøõÈò∂ËØç'
                    }
                };

                document.getElementById('difficultyDesc').textContent = descriptions[this.currentSubject].easy;
                document.getElementById('difficultyDesc2').textContent = descriptions[this.currentSubject].medium;
                document.getElementById('difficultyDesc3').textContent = descriptions[this.currentSubject].hard;
            }

            selectOption(index) {
                // Ê∏ÖÈô§‰πãÂâçÁöÑÈÄâÊã©
                this.optionBtns.forEach(btn => btn.classList.remove('selected'));
                
                // ÈÄâÊã©ÂΩìÂâçÈÄâÈ°π
                this.optionBtns[index].classList.add('selected');
                this.selectedOption = index;
                
                // Ëá™Âä®Êèê‰∫§Á≠îÊ°àÔºà500ÊØ´ÁßíÂª∂ËøüÔºâ
                if (this.autoNextTimeout) {
                    clearTimeout(this.autoNextTimeout);
                }
                
                this.autoNextTimeout = setTimeout(() => {
                    this.submitAnswer();
                }, 500);
            }

            generateQuestions() {
                this.questions = [];
                
                if (this.currentSubject === 'math') {
                    this.generateMathQuestions();
                } else if (this.currentSubject === 'chinese') {
                    this.generateChineseQuestions();
                } else {
                    this.generateEnglishQuestions();
                }
                
                // Êâì‰π±È°∫Â∫è
                for (let i = this.questions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.questions[i], this.questions[j]] = [this.questions[j], this.questions[i]];
                }
                
                this.stats.total = this.questions.length;
                this.stats.unanswered = this.questions.length;
            }

            generateMathQuestions() {
                let maxNum, questionCount;
                
                switch (this.currentDifficulty) {
                    case 'easy':
                        maxNum = 50;
                        questionCount = 20;
                        break;
                    case 'medium':
                        maxNum = 100;
                        questionCount = 25;
                        break;
                    case 'hard':
                        maxNum = 1000;
                        questionCount = 30;
                        break;
                }
                
                // ÁîüÊàêÂä†Ê≥ïÈ¢ò
                for (let i = 0; i < questionCount / 2; i++) {
                    const a = Math.floor(Math.random() * maxNum) + 1;
                    const b = Math.floor(Math.random() * (maxNum - a)) + 1;
                    this.questions.push({
                        question: `${a} + ${b} = `,
                        answer: a + b,
                        type: 'input',
                        answered: false,
                        correct: null
                    });
                }
                
                // ÁîüÊàêÂáèÊ≥ïÈ¢ò
                for (let i = 0; i < questionCount / 2; i++) {
                    const a = Math.floor(Math.random() * maxNum) + 2;
                    const b = Math.floor(Math.random() * a) + 1;
                    this.questions.push({
                        question: `${a} - ${b} = `,
                        answer: a - b,
                        type: 'input',
                        answered: false,
                        correct: null
                    });
                }
            }

            generateChineseQuestions() {
                const characterSets = {
                    easy: [
                        {char: '‰∏Ä', pinyin: 'yƒ´'}, {char: '‰∫å', pinyin: '√®r'}, {char: '‰∏â', pinyin: 'sƒÅn'},
                        {char: 'Âõõ', pinyin: 's√¨'}, {char: '‰∫î', pinyin: 'w«î'}, {char: 'ÂÖ≠', pinyin: 'li√π'},
                        {char: '‰∏É', pinyin: 'qƒ´'}, {char: 'ÂÖ´', pinyin: 'bƒÅ'}, {char: '‰πù', pinyin: 'ji«î'},
                        {char: 'ÂçÅ', pinyin: 'sh√≠'}, {char: 'Â§ß', pinyin: 'd√†'}, {char: 'Â∞è', pinyin: 'xi«éo'},
                        {char: '‰∫∫', pinyin: 'r√©n'}, {char: 'Âè£', pinyin: 'k«íu'}, {char: 'Êâã', pinyin: 'sh«íu'}
                    ],
                    medium: [
                        {char: 'Â≠¶', pinyin: 'xu√©'}, {char: 'Ê†°', pinyin: 'xi√†o'}, {char: 'ËÄÅ', pinyin: 'l«éo'},
                        {char: 'Â∏à', pinyin: 'shƒ´'}, {char: 'Âêå', pinyin: 't√≥ng'}, {char: 'Â≠¶', pinyin: 'xu√©'},
                        {char: 'Êúã', pinyin: 'p√©ng'}, {char: 'Âèã', pinyin: 'y«íu'}, {char: 'ÂÆ∂', pinyin: 'jiƒÅ'},
                        {char: 'Áà∏', pinyin: 'b√†'}, {char: 'Â¶à', pinyin: 'mƒÅ'}, {char: 'Âì•', pinyin: 'gƒì'},
                        {char: 'Âßê', pinyin: 'jiƒõ'}, {char: 'Âºü', pinyin: 'd√¨'}, {char: 'Â¶π', pinyin: 'm√®i'}
                    ],
                    hard: [
                        {char: 'ÊºÇ', pinyin: 'pi√†o'}, {char: '‰∫Æ', pinyin: 'li√†ng'}, {char: 'ËÅ™', pinyin: 'c≈çng'},
                        {char: 'Êòé', pinyin: 'm√≠ng'}, {char: 'Âãá', pinyin: 'y«íng'}, {char: 'Êï¢', pinyin: 'g«én'},
                        {char: 'Ê∏©', pinyin: 'wƒìn'}, {char: 'Êüî', pinyin: 'r√≥u'}, {char: 'ÂñÑ', pinyin: 'sh√†n'},
                        {char: 'ËâØ', pinyin: 'li√°ng'}, {char: 'ËØö', pinyin: 'ch√©ng'}, {char: 'ÂÆû', pinyin: 'sh√≠'},
                        {char: 'Âä™', pinyin: 'n«î'}, {char: 'Âäõ', pinyin: 'l√¨'}, {char: 'Ëøõ', pinyin: 'j√¨n'}
                    ]
                };

                const characters = characterSets[this.currentDifficulty];
                const questionCount = this.currentDifficulty === 'easy' ? 15 : 
                                     this.currentDifficulty === 'medium' ? 20 : 25;

                for (let i = 0; i < questionCount; i++) {
                    const randomChar = characters[Math.floor(Math.random() * characters.length)];
                    const otherChars = characters.filter(c => c !== randomChar);
                    
                    if (Math.random() > 0.5) {
                        // ÁúãÊ±âÂ≠óÈÄâÊãºÈü≥
                        const options = [randomChar.pinyin];
                        while (options.length < 4) {
                            const randomOther = otherChars[Math.floor(Math.random() * otherChars.length)];
                            if (!options.includes(randomOther.pinyin)) {
                                options.push(randomOther.pinyin);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `"${randomChar.char}" ÁöÑÊãºÈü≥ÊòØÔºü`,
                            answer: randomChar.pinyin,
                            options: options,
                            correctIndex: options.indexOf(randomChar.pinyin),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    } else {
                        // ÁúãÊãºÈü≥ÈÄâÊ±âÂ≠ó
                        const options = [randomChar.char];
                        while (options.length < 4) {
                            const randomOther = otherChars[Math.floor(Math.random() * otherChars.length)];
                            if (!options.includes(randomOther.char)) {
                                options.push(randomOther.char);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `ÊãºÈü≥ "${randomChar.pinyin}" ÂØπÂ∫îÁöÑÊ±âÂ≠óÊòØÔºü`,
                            answer: randomChar.char,
                            options: options,
                            correctIndex: options.indexOf(randomChar.char),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    }
                }
            }

            generateEnglishQuestions() {
                const wordSets = {
                    easy: [
                        {english: 'cat', chinese: 'Áå´'}, {english: 'dog', chinese: 'Áãó'}, {english: 'book', chinese: '‰π¶'},
                        {english: 'pen', chinese: 'Á¨î'}, {english: 'apple', chinese: 'ËãπÊûú'}, {english: 'water', chinese: 'Ê∞¥'},
                        {english: 'milk', chinese: 'ÁâõÂ•∂'}, {english: 'bread', chinese: 'Èù¢ÂåÖ'}, {english: 'fish', chinese: 'È±º'},
                        {english: 'bird', chinese: 'È∏ü'}, {english: 'tree', chinese: 'Ê†ë'}, {english: 'flower', chinese: 'Ëä±'},
                        {english: 'sun', chinese: 'Â§™Èò≥'}, {english: 'moon', chinese: 'Êúà‰∫Æ'}, {english: 'star', chinese: 'ÊòüÊòü'}
                    ],
                    medium: [
                        {english: 'school', chinese: 'Â≠¶Ê†°'}, {english: 'teacher', chinese: 'ËÄÅÂ∏à'}, {english: 'student', chinese: 'Â≠¶Áîü'},
                        {english: 'family', chinese: 'ÂÆ∂Â∫≠'}, {english: 'mother', chinese: 'Â¶àÂ¶à'}, {english: 'father', chinese: 'Áà∏Áà∏'},
                        {english: 'friend', chinese: 'ÊúãÂèã'}, {english: 'happy', chinese: 'Âø´‰πê'}, {english: 'beautiful', chinese: 'Áæé‰∏Ω'},
                        {english: 'smart', chinese: 'ËÅ™Êòé'}, {english: 'kind', chinese: 'ÂñÑËâØ'}, {english: 'brave', chinese: 'ÂãáÊï¢'},
                        {english: 'strong', chinese: 'Âº∫Â£Æ'}, {english: 'fast', chinese: 'Âø´ÈÄü'}, {english: 'slow', chinese: 'ÁºìÊÖ¢'}
                    ],
                    hard: [
                        {english: 'rainbow', chinese: 'ÂΩ©Ëôπ'}, {english: 'butterfly', chinese: 'Ëù¥Ëù∂'}, {english: 'elephant', chinese: 'Â§ßË±°'},
                        {english: 'mountain', chinese: 'Â±±'}, {english: 'ocean', chinese: 'Êµ∑Ê¥ã'}, {english: 'forest', chinese: 'Ê£ÆÊûó'},
                        {english: 'adventure', chinese: 'ÂÜíÈô©'}, {english: 'wonderful', chinese: 'Á≤æÂΩ©'}, {english: 'imagination', chinese: 'ÊÉ≥Ë±°'},
                        {english: 'discovery', chinese: 'ÂèëÁé∞'}, {english: 'treasure', chinese: 'ÂÆùËóè'}, {english: 'mystery', chinese: 'Á•ûÁßò'},
                        {english: 'journey', chinese: 'ÊóÖÁ®ã'}, {english: 'fantastic', chinese: 'Â•áÂ¶ô'}, {english: 'magical', chinese: 'È≠îÊ≥ï'}
                    ]
                };

                const words = wordSets[this.currentDifficulty];
                const questionCount = this.currentDifficulty === 'easy' ? 15 : 
                                     this.currentDifficulty === 'medium' ? 20 : 25;

                for (let i = 0; i < questionCount; i++) {
                    const randomWord = words[Math.floor(Math.random() * words.length)];
                    const otherWords = words.filter(w => w !== randomWord);
                    
                    if (Math.random() > 0.5) {
                        // ÁúãËã±ËØ≠ÈÄâ‰∏≠Êñá
                        const options = [randomWord.chinese];
                        while (options.length < 4) {
                            const randomOther = otherWords[Math.floor(Math.random() * otherWords.length)];
                            if (!options.includes(randomOther.chinese)) {
                                options.push(randomOther.chinese);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `"${randomWord.english}" ÁöÑ‰∏≠ÊñáÊÑèÊÄùÊòØÔºü`,
                            answer: randomWord.chinese,
                            options: options,
                            correctIndex: options.indexOf(randomWord.chinese),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    } else {
                        // Áúã‰∏≠ÊñáÈÄâËã±ËØ≠
                        const options = [randomWord.english];
                        while (options.length < 4) {
                            const randomOther = otherWords[Math.floor(Math.random() * otherWords.length)];
                            if (!options.includes(randomOther.english)) {
                                options.push(randomOther.english);
                            }
                        }
                        this.shuffleArray(options);
                        
                        this.questions.push({
                            question: `"${randomWord.chinese}" ÁöÑËã±ËØ≠ÂçïËØçÊòØÔºü`,
                            answer: randomWord.english,
                            options: options,
                            correctIndex: options.indexOf(randomWord.english),
                            type: 'choice',
                            answered: false,
                            correct: null
                        });
                    }
                }
            }

            shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            startGame() {
                this.isGameActive = true;
                this.currentIndex = 0;
                this.stats.streak = 0;
                this.selectedOption = null;
                
                if (this.currentSubject === 'math') {
                    this.answerInput.disabled = false;
                    this.submitBtn.disabled = false;
                } else {
                    this.resetOptionButtons();
                }
                
                this.startBtn.textContent = '‚è∏Ô∏è ÊöÇÂÅú';
                this.showCurrentQuestion();
                
                if (this.currentSubject === 'math') {
                    this.answerInput.focus();
                }
            }

            showCurrentQuestion() {
                if (this.currentIndex < this.questions.length) {
                    const current = this.questions[this.currentIndex];
                    this.questionEl.textContent = current.question;
                    
                    if (current.type === 'input') {
                        this.answerInput.value = '';
                        this.nextBtn.disabled = true;
                        this.submitBtn.disabled = false;
                    } else {
                        // ÈÄâÊã©È¢òÊ®°Âºè
                        this.resetOptionButtons();
                        current.options.forEach((option, index) => {
                            this.optionBtns[index].textContent = option;
                        });
                        this.selectedOption = null;
                    }
                    
                    this.feedback.className = 'feedback';
                    this.feedback.textContent = this.currentSubject === 'math' ? 'ËØ∑ËæìÂÖ•Á≠îÊ°à ü§î' : 'ËØ∑ÈÄâÊã©Á≠îÊ°à ü§î';
                    
                    // Ê∏ÖÈô§Ëá™Âä®‰∏ã‰∏ÄÈ¢òÁöÑÂÆöÊó∂Âô®
                    if (this.autoNextTimeout) {
                        clearTimeout(this.autoNextTimeout);
                        this.autoNextTimeout = null;
                    }
                } else {
                    this.endGame();
                }
            }

            resetOptionButtons() {
                this.optionBtns.forEach(btn => {
                    btn.classList.remove('selected', 'correct', 'incorrect');
                    btn.disabled = false;
                });
            }

            submitAnswer() {
                const current = this.questions[this.currentIndex];
                let userAnswer, isCorrect;

                if (current.type === 'input') {
                    userAnswer = parseInt(this.answerInput.value);
                    if (isNaN(userAnswer)) {
                        this.showFeedback('ËØ∑ËæìÂÖ•‰∏Ä‰∏™Êï∞Â≠óÔºÅ', 'incorrect');
                        return;
                    }
                    isCorrect = userAnswer === current.answer;
                } else {
                    if (this.selectedOption === null) {
                        this.showFeedback('ËØ∑ÈÄâÊã©‰∏Ä‰∏™Á≠îÊ°àÔºÅ', 'incorrect');
                        return;
                    }
                    isCorrect = this.selectedOption === current.correctIndex;
                    
                    // ÊòæÁ§∫ÈÄâÊã©È¢òÁªìÊûú
                    this.optionBtns.forEach((btn, index) => {
                        btn.disabled = true;
                        if (index === current.correctIndex) {
                            btn.classList.add('correct');
                        } else if (index === this.selectedOption && !isCorrect) {
                            btn.classList.add('incorrect');
                        }
                    });
                }

                current.answered = true;
                this.stats.unanswered--;
                
                if (isCorrect) {
                    current.correct = true;
                    this.stats.correct++;
                    this.stats.streak++;
                    this.stats.maxStreak = Math.max(this.stats.maxStreak, this.stats.streak);
                    
                    const encouragement = this.getEncouragement();
                    this.showFeedback(`üéâ ${encouragement}`, 'correct');
                    this.showCelebration();
                    this.playSound(523.25, 0.3, 'success');
                    
                    // 500ÊØ´ÁßíÂêéËá™Âä®‰∏ã‰∏ÄÈ¢ò
                    this.autoNextTimeout = setTimeout(() => {
                        this.nextQuestion();
                    }, 500);
                } else {
                    current.correct = false;
                    this.stats.incorrect++;
                    this.stats.streak = 0;
                    this.showFeedback(`‚ùå Á≠îÈîô‰∫ÜÔºåÊ≠£Á°ÆÁ≠îÊ°àÊòØ ${current.answer}ÔºåÂÜçÊé•ÂÜçÂéâÔºÅ`, 'incorrect');
                    this.playSound(196, 0.5, 'error');
                    
                    // ÈîôËØØÊó∂Âª∂ËøüÊõ¥ÈïøÊó∂Èó¥ÂÜçËøõÂÖ•‰∏ã‰∏ÄÈ¢ò
                    this.autoNextTimeout = setTimeout(() => {
                        this.nextQuestion();
                    }, 1500);
                }

                if (current.type === 'input') {
                    this.submitBtn.disabled = true;
                    this.nextBtn.disabled = false;
                }
                
                this.updateStats();
                this.updateStreakDisplay();
            }

            getEncouragement() {
                const encouragements = [
                    'Â§™Ê£í‰∫ÜÔºÅ', 'Á≠îÂØπ‰∫ÜÔºÅ', 'ÁúüËÅ™ÊòéÔºÅ', 'ÂæàÊ£íÔºÅ', 'ÁªßÁª≠Âä†Ê≤πÔºÅ',
                    '‰Ω†ÁúüÂéâÂÆ≥ÔºÅ', 'ÂÆåÁæéÔºÅ', '‰ºòÁßÄÔºÅ', 'Â•ΩÊ†∑ÁöÑÔºÅ', 'Áúü‰∏çÈîôÔºÅ'
                ];
                return encouragements[Math.floor(Math.random() * encouragements.length)];
            }

            updateStreakDisplay() {
                if (this.stats.streak >= 3) {
                    this.streakIndicator.style.display = 'block';
                    this.streakCountEl.textContent = this.stats.streak;
                } else {
                    this.streakIndicator.style.display = 'none';
                }
            }

            nextQuestion() {
                if (this.autoNextTimeout) {
                    clearTimeout(this.autoNextTimeout);
                    this.autoNextTimeout = null;
                }
                this.currentIndex++;
                this.showCurrentQuestion();
            }

            showFeedback(message, type) {
                this.feedback.textContent = message;
                this.feedback.className = `feedback ${type}`;
            }

            showCelebration() {
                const emojis = ['üåü', 'üéâ', 'üéä', '‚≠ê', '‚ú®', 'üèÜ', 'üëè', 'ü•≥'];
                const celebration = document.createElement('div');
                celebration.className = 'celebration';
                celebration.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                document.body.appendChild(celebration);
                
                setTimeout(() => {
                    if (document.body.contains(celebration)) {
                        document.body.removeChild(celebration);
                    }
                }, 800);
            }

            updateStats() {
                this.totalCountEl.textContent = this.stats.total;
                this.correctCountEl.textContent = this.stats.correct;
                this.incorrectCountEl.textContent = this.stats.incorrect;
                this.unansweredCountEl.textContent = this.stats.unanswered;
            }

            endGame() {
                this.isGameActive = false;
                const accuracy = Math.round((this.stats.correct / this.stats.total) * 100);
                let message = `üéä Ê∏∏ÊàèÁªìÊùüÔºÅ\nÁ≠îÂØπ‰∫Ü ${this.stats.correct} È¢òÔºåÁ≠îÈîô‰∫Ü ${this.stats.incorrect} È¢ò\nÊ≠£Á°ÆÁéáÔºö${accuracy}%\nÊúÄÈ´òËøûÂáªÔºö${this.stats.maxStreak} È¢ò`;
                
                if (accuracy >= 90) {
                    message += '\nüèÜ Â§™ÂéâÂÆ≥‰∫ÜÔºÅ‰Ω†ÊòØÂ≠¶‰π†Â∞èÂ§©ÊâçÔºÅ';
                } else if (accuracy >= 80) {
                    message += '\nüåü ÂæàÊ£íÔºÅÁªßÁª≠Âä™ÂäõÂì¶ÔºÅ';
                } else if (accuracy >= 70) {
                    message += '\nüí™ ‰∏çÈîôÔºÅÂ§öÁªÉ‰π†‰ºöÊõ¥Â•ΩÁöÑÔºÅ';
                } else {
                    message += '\nü§ó Ê≤°ÂÖ≥Á≥ªÔºåÂ§öÁªÉ‰π†Â∞±‰ºöËøõÊ≠•ÁöÑÔºÅ';
                }

                this.feedback.textContent = message;
                this.feedback.className = 'feedback ready-message';
                this.questionEl.textContent = 'ÁÇπÂáªÈáçÊñ∞ÂºÄÂßãÁªßÁª≠ÁªÉ‰π†ÔºÅ';
                
                if (this.currentSubject === 'math') {
                    this.answerInput.disabled = true;
                    this.submitBtn.disabled = true;
                    this.nextBtn.disabled = true;
                } else {
                    this.optionBtns.forEach(btn => btn.disabled = true);
                }
                
                this.startBtn.textContent = 'üöÄ ÂºÄÂßãÁªÉ‰π†';
            }

            resetGame() {
                this.currentIndex = 0;
                this.stats = { correct: 0, incorrect: 0, total: 0, unanswered: 0, streak: 0, maxStreak: 0 };
                this.isGameActive = false;
                this.selectedOption = null;
                
                if (this.autoNextTimeout) {
                    clearTimeout(this.autoNextTimeout);
                    this.autoNextTimeout = null;
                }
                
                this.generateQuestions();
                this.updateStats();
                this.questionEl.textContent = 'ÈÄâÊã©ÁßëÁõÆÂíåÈöæÂ∫¶ÔºåÁÑ∂ÂêéÂºÄÂßãÁªÉ‰π†ÂêßÔºÅ';
                this.answerInput.value = '';
                this.answerInput.disabled = true;
                this.submitBtn.disabled = true;
                this.nextBtn.disabled = true;
                this.resetOptionButtons();
                this.startBtn.textContent = 'üöÄ ÂºÄÂßãÁªÉ‰π†';
                this.feedback.textContent = 'ÈÄâÊã©ÁßëÁõÆÂíåÈöæÂ∫¶ÔºåÁÑ∂ÂêéÁÇπÂáª"ÂºÄÂßãÁªÉ‰π†"ÂêßÔºÅüí™';
                this.feedback.className = 'feedback ready-message';
                this.streakIndicator.style.display = 'none';
            }
        }

        // ÂêØÂä®Ê∏∏Êàè
        document.addEventListener('DOMContentLoaded', () => {
            new LearningGame();
        });
    </script>
</body>
</html>
